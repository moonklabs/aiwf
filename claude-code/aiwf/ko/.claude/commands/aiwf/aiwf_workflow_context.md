# 워크플로우 컨텍스트 로드

프로젝트의 전체 워크플로우 상태를 이해하고, AI가 Milestone → Sprint → Task 계층 구조 내에서 올바른 결정을 내릴 수 있도록 컨텍스트를 제공합니다.

## 핵심 목적

- **계층적 이해**: Milestone/Sprint/Task의 3단계 구조 파악
- **규칙 기반 작업**: 워크플로우 규칙에 따른 올바른 진행
- **자동화된 의사결정**: AI가 스스로 다음 단계 판단
- **일관성 보장**: 전체 프로젝트 플로우와 정렬된 작업

## 실행 프로세스

### 1. 상태 데이터 로드

**필수 파일 확인 및 로드:**
```
.aiwf/
├── task-state-index.json      # 현재 상태
├── workflow-rules.json        # 워크플로우 규칙
├── 00_PROJECT_MANIFEST.md     # 프로젝트 정보
└── 02_REQUIREMENTS/           # Milestone 정의
```

### 2. 현재 위치 파악

**3단계 계층 구조에서 현재 위치:**
```
현재 위치: M01 → S02 → T03
├── Milestone: M01 - 기본 인증 시스템 (진행률: 67%)
├── Sprint: S02 - 핵심 기능 개발 (진행률: 40%)
└── Task: T03 - 사용자 인증 API 구현 (상태: in_progress)
```

### 3. 워크플로우 규칙 적용

**핵심 규칙 확인:**

#### Milestone 규칙
- ✓ 현재 Milestone 내에서만 작업
- ✓ Milestone 목표와 정렬된 작업만 수행
- ✓ 모든 Sprint 완료 시 Milestone 완료

#### Sprint 규칙  
- ✓ 순차적 진행 (S01 → S02 → S03)
- ✓ 이전 Sprint 80% 완료 시 다음 Sprint 준비
- ✓ Sprint 100% 완료 시 자동 전환

#### Task 규칙
- ✓ 의존성이 해결된 Task만 시작
- ✓ 같은 Sprint 내 Task만 동시 실행
- ✓ 우선순위 기반 실행 순서

### 4. 상태 검증

**현재 상태의 일관성 확인:**
```javascript
// 검증 항목
1. 활성 Sprint가 현재 Milestone에 속하는가?
2. 진행 중 Task가 활성 Sprint에 속하는가?
3. 완료된 Task의 의존 Task가 대기 중인가?
4. Sprint 진행률과 Task 상태가 일치하는가?
5. 차단된 Task의 블로커가 해결되었는가?
```

### 5. 컨텍스트 정보 생성

**AI가 이해할 수 있는 구조화된 컨텍스트:**

```markdown
## 📍 현재 워크플로우 컨텍스트

### 프로젝트 위치
- **Milestone**: M01 - 기본 인증 시스템 (2/3 Sprints 완료)
- **Sprint**: S02 - 핵심 기능 개발 (1/3 Tasks 완료)  
- **Focus**: T03 - 사용자 인증 API 구현 (45% 진행)

### 진행 상황
```
M01 [████████░░] 67%
 └─ S01 [██████████] 100% ✅
 └─ S02 [████░░░░░░] 40% 🔄
     ├─ T03 [████░░░░░░] 45% 🔄 (현재)
     ├─ T04 [░░░░░░░░░░] 0% ⏳ (대기: T03 의존)
     └─ T05 [░░░░░░░░░░] 0% ⏳ (대기: T03, T04 의존)
 └─ S03 [░░░░░░░░░░] 0% 📝 (계획 필요)
```

### 워크플로우 상태
- **현재 단계**: Implementation
- **다음 마일스톤**: S02 완료 → S03 계획 → M01 완료
- **예상 경로**: T03 완료 → T04 시작 → T05 시작 → S02 완료

### 적용 중인 규칙
1. **Sprint 순차 진행**: S02 진행 중, S03은 S02 80% 완료 후 준비
2. **Task 의존성**: T04는 T03 완료 후 시작 가능
3. **병렬 실행 불가**: T04, T05는 의존성으로 인해 순차 실행

### 주의 사항
⚠️ 차단 요소: 없음
⚠️ 위험 요소: S03 Task 미생성 (사전 계획 필요)
⚠️ 기한 임박: M01 목표일 2주 남음
```

### 6. 의사결정 가이드 제공

**AI를 위한 명확한 행동 지침:**

```markdown
## 🎯 워크플로우 기반 행동 지침

### 즉시 실행 가능
1. **T03 계속 진행**
   - 이유: 현재 진행 중, 의존 Task 대기 중
   - 목표: register endpoint 완성 (2시간)
   - 다음: 단위 테스트 작성

### 준비 필요
1. **T04 준비**
   - 조건: T03 API 엔드포인트 완성
   - 준비: API 문서 작성
   - 예상: T03 완료 후 즉시 시작

2. **S03 계획**
   - 조건: S02 80% 진행 (현재 40%)
   - 준비: 요구사항 분석, Task 정의
   - 예상: 3-4일 후

### 금지 사항
❌ S03 Task를 지금 시작 (Sprint 순서 위반)
❌ T04를 T03 완료 전 시작 (의존성 위반)
❌ M02 작업 시작 (현재 Milestone 미완료)

### 권장 워크플로우
1. T03 완료 (45% → 100%)
2. T04 시작 및 완료
3. T05 시작 (T04 완료 후)
4. S02 완료 확인
5. S03 계획 및 Task 생성
6. S03 실행
7. M01 완료 및 리뷰
```

## 출력 형식

```
🔄 워크플로우 컨텍스트 로드 중...

✅ 컨텍스트 로드 완료!

📊 프로젝트 구조:
M01 - 기본 인증 시스템
├── S01 - 프로젝트 설정 [완료]
├── S02 - 핵심 기능 개발 [진행 중]
└── S03 - 테스트 및 마무리 [대기]

🎯 현재 포커스:
위치: M01 > S02 > T03
상태: 사용자 인증 API 구현 중 (45%)
다음: register endpoint 유효성 검사

📋 워크플로우 규칙:
- Sprint 순차 진행 ✓
- Task 의존성 확인 ✓
- Milestone 경계 준수 ✓

💡 AI 행동 지침:
1. T03 작업 계속 (현재 진행 중)
2. 완료 후 T04 준비
3. S02 80% 도달 시 S03 계획

⚠️ 주의:
- T04는 T03 완료 필수
- S03은 아직 시작 불가
```

## 사용 시나리오

### 1. 작업 시작 전 필수 실행
```bash
# 1. 워크플로우 컨텍스트 로드
/aiwf:workflow_context

# 2. 컨텍스트 기반 작업 결정
/aiwf:next_action

# 3. 결정된 작업 실행
/aiwf:do_task T03
```

### 2. YOLO 모드 통합
```bash
/aiwf:yolo
# → 내부적으로 workflow_context 자동 실행
# → 워크플로우 규칙 기반 자동 진행
```

### 3. 상태 전환 시
```bash
# Sprint 완료 임박 시
/aiwf:workflow_context
# → S02 80% 확인
# → S03 준비 시작 제안
```

## 워크플로우 규칙 파일

시스템은 `.aiwf/workflow-rules.json` 파일의 규칙을 참조합니다:
- Milestone/Sprint/Task 전환 규칙
- 우선순위 계산 로직
- 자동화 트리거
- 검증 규칙

## 관련 명령어

- `/aiwf:next_action` - 워크플로우 기반 다음 작업 결정
- `/aiwf:transition` - Sprint/Milestone 전환 관리
- `/aiwf:validate_workflow` - 워크플로우 일관성 검증
- `/aiwf:update_state` - 상태 인덱스 업데이트

이 명령어는 AI가 프로젝트의 전체 맥락을 이해하고, 올바른 워크플로우 내에서 작업할 수 있도록 하는 핵심 기능입니다.