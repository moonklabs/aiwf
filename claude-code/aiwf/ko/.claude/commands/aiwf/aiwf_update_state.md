# 상태 인덱스 업데이트

모든 태스크 파일을 스캔하여 중앙 상태 인덱스(task-state-index.json)를 업데이트합니다. AI가 프로젝트의 현재 상태를 항상 정확히 파악할 수 있도록 합니다.

## 주요 목적

- **상태 중앙화**: 분산된 태스크 정보를 하나의 인덱스로 통합
- **AI 컨텍스트 유지**: 세션 간 상태 연속성 보장
- **진행 상황 추적**: 실시간 프로젝트 메트릭스 제공
- **다음 작업 제안**: 현재 상태 기반 지능형 작업 추천

## 실행 프로세스

### 1. 상태 인덱스 초기화 확인

**인덱스 파일 존재 확인:**
- `.aiwf/task-state-index.json` 파일 확인
- 없으면 새로 생성 (초기 구조로)
- 있으면 기존 파일 로드

### 2. 프로젝트 매니페스트 분석

**현재 프로젝트 상태 파악:**
- `00_PROJECT_MANIFEST.md` 읽기
- 현재 마일스톤 확인
- 활성 스프린트 확인
- 프로젝트 단계 (planning, implementation, testing 등)

### 3. 스프린트 디렉토리 스캔

**모든 스프린트 폴더 순회:**
```bash
.aiwf/03_SPRINTS/
├── S01_M01_Initial_Setup/
├── S02_M01_Core_Features/
└── S03_M01_Testing/
```

**각 스프린트별로:**
1. 스프린트 메타 파일 읽기 (`S##_sprint_meta.md`)
2. 스프린트 상태 확인 (planning, active, completed)
3. 스프린트 내 모든 태스크 파일 수집

### 4. 태스크 파일 분석

**각 태스크 파일에서 정보 추출:**
- 태스크 ID (T##_S##_M##)
- 제목 (`# T##: [제목]`)
- 상태 (`**상태**: pending/in_progress/completed/blocked`)
- 우선순위 (`**우선순위**: high/medium/low`)
- 예상/실제 시간
- 의존성 정보
- OUTPUT LOG 확인 (실제 완료 여부)

**상태 판단 로직:**
```
1. OUTPUT LOG에 ✅ 또는 "완료" → completed
2. 상태 필드 확인 → 해당 상태
3. 기본값 → pending
```

### 5. 메트릭스 계산

**프로젝트 전체 통계:**
- 총 태스크 수
- 완료된 태스크 수
- 진행 중인 태스크 수
- 대기 중인 태스크 수
- 차단된 태스크 수
- 전체 진행률 (%)

**스프린트별 통계:**
- 스프린트별 태스크 수
- 스프린트별 완료율
- 예상 완료일

### 6. 현재 포커스 업데이트

**AI 작업 컨텍스트:**
- 현재 진행 중인 태스크 자동 감지
- 마지막 작업 태스크 기록
- 세션 노트 유지

### 7. 다음 액션 생성

**우선순위 기반 추천:**

1. **높음**: 진행 중인 태스크 계속하기
2. **중간**: 현재 스프린트의 새 태스크 시작
3. **낮음**: 차단 해제, 문서화, 리뷰

### 8. 인덱스 파일 저장

**업데이트된 정보 저장:**
```json
{
  "version": "1.0.0",
  "last_updated": "2025-01-22T16:00:00Z",
  "last_updated_by": "aiwf-state-update",
  "project_info": { ... },
  "current_focus": { ... },
  "tasks": { ... },
  "sprint_summary": { ... },
  "next_actions": [ ... ],
  "metrics": { ... }
}
```

## 출력 형식

```
🔄 상태 인덱스 업데이트 중...

📊 스캔 결과:
- 스프린트: 3개
- 태스크: 15개
- 변경사항: 5개

✅ 상태 인덱스 업데이트 완료!

📈 프로젝트 현황:
  ✅ 완료: 8 (53%)
  🔄 진행 중: 2 (13%)
  ⏳ 대기: 4 (27%)
  ❌ 차단: 1 (7%)
  
  전체 진행률: [████████████░░░░░░░░] 53%

🎯 현재 포커스: T03_S02_M01 - 사용자 인증 API 구현

🚀 다음 추천 작업:
1. T03 register endpoint 완성 (2시간)
2. T03 단위 테스트 작성 (3시간)
3. T04 준비 - API 문서 검토 (1시간)
```

## 자동 실행 시나리오

다음 상황에서 자동으로 실행:
- 태스크 생성/수정 후
- 스프린트 계획 변경 시
- YOLO 모드 시작 전
- 프로젝트 리뷰 전
- AI 세션 시작 시

## CLI 명령어

```bash
# 상태 인덱스 업데이트
aiwf state update

# 별칭
aiwf state u
```

## 사용 예시

### 일반 업데이트
```bash
/aiwf:update_state
```

### 작업 시작 전 상태 확인
```bash
# 1. 상태 업데이트
/aiwf:update_state

# 2. 현재 상태 확인
/aiwf:check_state

# 3. 추천 태스크로 작업 시작
/aiwf:do_task T03
```

### YOLO 모드와 연동
```bash
# YOLO 시작 전 자동 실행
/aiwf:yolo
# → 내부적으로 update_state 실행
# → 최신 상태 기반으로 작업 진행
```

## 주의사항

- 대규모 프로젝트의 경우 스캔에 시간이 걸릴 수 있음
- 파일 형식이 표준을 따르지 않으면 일부 정보 누락 가능
- 수동으로 편집한 task-state-index.json은 덮어쓰여질 수 있음
- Git 상태와 동기화는 별도 명령어 필요

## 관련 명령어

- `/aiwf:check_state` - 현재 상태 확인
- `/aiwf:project_status` - 상세 프로젝트 현황
- `/aiwf:yolo` - 자동 작업 실행 (상태 업데이트 포함)

이 명령어는 AI가 항상 최신 프로젝트 상태를 인지하고, 일관된 작업을 수행할 수 있도록 하는 핵심 기능입니다.