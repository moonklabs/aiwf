# Architecture Decision Record (ADR) 생성 워크플로우

이 규칙은 AI가 아키텍처 결정사항을 체계적으로 문서화하기 위한 ADR(Architecture Decision Record)을 생성하도록 안내합니다.
사용자로부터 필요한 정보를 수집하고, 관련 코드베이스와 기존 ADR을 분석하여 포괄적인 아키텍처 문서를 작성합니다.

---

## 사용법

```bash
/aiwf:aiwf_create_adr [아키텍처 결정사항 제목]
```

**예시:**
- `/aiwf:aiwf_create_adr API Gateway Pattern 도입`
- `/aiwf:aiwf_create_adr GraphQL vs REST API 선택`
- `/aiwf:aiwf_create_adr` (대화형 모드)

---

## 0. 워크플로우 상태 사전 검증

ADR 생성 프로세스를 시작하기 전에 현재 워크플로우 상태를 확인합니다:

- `aiwf state show` 명령어로 현재 워크플로우 상태 확인
- 진행 중인 작업이나 차단 요소 식별
- ADR 생성이 현재 워크플로우에 미치는 영향 평가
- 프로젝트 구조 및 기존 ADR 문서 확인

**상태 검증 결과:**
- 현재 활성 태스크: [상태 명령어 결과]
- 프로젝트 구조 무결성: [검증 결과]
- 기존 ADR 수: [.aiwf/05_ARCHITECTURAL_DECISIONS/ 내 파일 개수]
- ADR 생성 준비성: [준비 상태]

---

## 1. 기존 ADR 및 프로젝트 분석

ADR 생성 전에 관련 컨텍스트를 수집합니다:

### 1.1 기존 ADR 스캔
- `.aiwf/05_ARCHITECTURAL_DECISIONS/` 디렉토리 스캔
- 관련 ADR 목록 및 요약 제공
- 다음 ADR 번호 자동 계산

### 1.2 프로젝트 아키텍처 분석
- `.aiwf/01_PROJECT_DOCS/ARCHITECTURE.md` 확인
- 현재 기술 스택 및 아키텍처 패턴 파악
- 관련 코드베이스 구조 이해

### 1.3 관련 문서 확인
- 프로젝트 매니페스트 확인
- 현재 마일스톤 및 스프린트 상태 파악
- 관련 태스크 또는 이슈 식별

**분석 결과 요약 제공:**
```
📊 프로젝트 컨텍스트 분석:
- 기존 ADR: [개수]개
- 다음 ADR 번호: ADR[###]
- 프로젝트 타입: [예: Node.js/NestJS Monorepo]
- 현재 주요 기술 스택: [예: TypeScript, pnpm workspace, Git submodules]
- 관련 기존 ADR: [있다면 목록]
```

---

## 2. 아키텍처 결정사항 정보 수집

사용자로부터 ADR 작성에 필요한 정보를 수집합니다. argument가 제공되지 않은 경우 대화형으로 질문합니다.

### 필수 정보

1. **`<decision-title>`**: 아키텍처 결정사항의 명확한 제목
   - 예: "API Gateway 패턴 도입", "GraphQL 전환 결정"

2. **`<context>`**: 왜 이 결정이 필요한가?
   - 현재 직면한 문제나 이슈
   - 비즈니스 요구사항
   - 기술적 제약사항

3. **`<decision>`**: 무엇을 선택했는가?
   - 선택한 솔루션의 구체적 설명
   - 어떻게 구현할 것인지

4. **`<alternatives>`**: 고려한 다른 대안들
   - 최소 2개 이상의 대안
   - 각 대안을 선택하지 않은 이유

### 선택 정보

5. **`<status>`**: 결정 상태 (기본값: proposed)
   - `proposed`: 제안됨
   - `accepted`: 승인됨
   - `deprecated`: 폐기됨
   - `superseded`: 대체됨

6. **`<related-adrs>`**: 관련 ADR이 있는가?
   - 이전 ADR을 수정/대체하는 경우
   - 관련된 다른 아키텍처 결정

7. **`<implementation-notes>`**: 구현 시 고려사항
   - 마이그레이션 단계
   - 기술적 세부사항
   - 팀 교육 필요사항

> ⚠️ 모든 질문과 응답은 한국어로 진행됩니다.

---

## 3. 코드베이스 분석 및 영향도 평가

수집한 정보를 바탕으로 코드베이스를 분석합니다:

### 3.1 영향받는 컴포넌트 식별
- 변경이 필요한 파일이나 모듈 탐색
- 의존성 분석
- 테스트 범위 평가

### 3.2 기술적 타당성 검증
- 제안된 솔루션의 기술적 실현 가능성
- 성능 영향 분석
- 보안 고려사항

### 3.3 품질 속성 영향 평가
다음 품질 속성에 미치는 영향 분석:
- **확장성(Scalability)**
- **유지보수성(Maintainability)**
- **성능(Performance)**
- **보안(Security)**
- **테스트 가능성(Testability)**
- **개발자 경험(Developer Experience)**

---

## 4. ADR 문서 생성

수집된 정보와 분석 결과를 바탕으로 ADR 문서를 생성합니다.

### 4.1 ADR 구조

`.aiwf/99_TEMPLATES/adr_template.md`를 기반으로 다음 내용을 포함:

```markdown
---
adr_id: ADR[###]
title: "[결정사항 제목]"
status: "[proposed/accepted/deprecated/superseded]"
date: [YYYY-MM-DD]
authors: ["[작성자]"]
---

# ADR[###]: [결정사항 제목]

## Status

[status] - [YYYY-MM-DD]

## Context

[문제 상황 및 결정이 필요한 이유를 상세히 기술]

### 배경
- 현재 상황
- 직면한 문제
- 비즈니스 요구사항

### 기술적 제약사항
- 현재 기술 스택
- 팀의 기술 역량
- 기존 아키텍처와의 호환성

## Decision

[선택한 솔루션의 상세 설명]

### 솔루션 개요
- 핵심 접근 방법
- 주요 컴포넌트

### 구현 방향
- 구체적인 구현 전략
- 사용할 기술/라이브러리

## Consequences

### Positive

- ✅ [품질 속성 개선사항]
- ✅ [비즈니스 가치]
- ✅ [개발자 경험 향상]

### Negative

- ⚠️ [트레이드오프]
- ⚠️ [잠재적 리스크]
- ⚠️ [추가 비용]

### Neutral

- ℹ️ [중립적 영향]

## Alternatives Considered

### [대안 1 이름]

**설명:**
[대안에 대한 상세 설명]

**장점:**
- [장점 1]
- [장점 2]

**단점:**
- [단점 1]
- [단점 2]

**선택하지 않은 이유:**
[구체적인 이유]

### [대안 2 이름]

[동일한 구조 반복]

## Implementation Notes

### 마이그레이션 계획
1. [단계 1]
2. [단계 2]
3. [단계 3]

### 기술적 고려사항
- [고려사항 1]
- [고려사항 2]

### 팀 준비사항
- 필요한 교육
- 문서 업데이트
- 코드 리뷰 체크리스트

### 성공 지표
- [측정 가능한 지표 1]
- [측정 가능한 지표 2]

## Related

- 관련 ADR: [ADR### - 제목]
- 관련 이슈: [#이슈번호]
- 참고 문서: [링크]
```

### 4.2 파일명 규칙

```
ADR_[###]_[제목_스네이크케이스].md
```

**예시:**
- `ADR_001_api_gateway_pattern.md`
- `ADR_002_graphql_migration.md`

### 4.3 저장 위치

```
.aiwf/05_ARCHITECTURAL_DECISIONS/ADR_[###]_[제목].md
```

---

## 5. AI 기반 추천 및 분석

AI는 다음을 자동으로 제공합니다:

### 5.1 대안 분석 강화
- 사용자가 제공하지 않은 추가 대안 제안
- 각 대안의 장단점 심층 분석
- 산업 표준 및 베스트 프랙티스 참고

### 5.2 리스크 분석
- 잠재적 기술 부채 식별
- 마이그레이션 복잡도 평가
- 팀 학습 곡선 예측

### 5.3 품질 속성 트레이드오프 매트릭스

| 품질 속성 | 현재 | 결정 후 | 영향도 |
|----------|------|---------|--------|
| 확장성 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | +2 |
| 유지보수성 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 0 |
| 성능 | ⭐⭐⭐⭐ | ⭐⭐⭐ | -1 |
| 복잡도 | ⭐⭐ | ⭐⭐⭐⭐ | +2 |

### 5.4 유사 프로젝트 사례 제공
- 유사한 결정을 내린 오픈소스 프로젝트
- 참고할 만한 블로그 포스트나 문서

---

## 6. 검증 및 피드백

ADR 초안을 생성한 후:

### 6.1 사용자 검토
```
📝 ADR 초안이 생성되었습니다:

제목: [ADR### - 제목]
상태: [proposed]
저장 위치: .aiwf/05_ARCHITECTURAL_DECISIONS/ADR_[###]_[제목].md

주요 내용:
- Context: [요약]
- Decision: [요약]
- 고려한 대안: [개수]개
- 긍정적 결과: [개수]개
- 부정적 결과: [개수]개

이 ADR을 저장하시겠습니까? (y/n)
또는 수정이 필요한 부분을 말씀해 주세요.
```

### 6.2 반복적 개선
- 사용자 피드백 반영
- 추가 정보 요청
- 문서 정제

---

## 7. 문서 저장 및 업데이트

### 7.1 ADR 파일 저장
- `.aiwf/05_ARCHITECTURAL_DECISIONS/` 디렉토리에 저장
- 적절한 파일명 사용
- Git 커밋 메시지 제안

### 7.2 관련 문서 업데이트

**프로젝트 매니페스트 업데이트:**
```markdown
## Architecture Decisions

- [ADR### - 제목] (YYYY-MM-DD) - [status]
```

**ARCHITECTURE.md 업데이트 제안:**
- 새로운 아키텍처 결정이 전체 아키텍처에 미치는 영향
- 업데이트가 필요한 섹션 식별

### 7.3 태스크 생성 제안
만약 ADR이 구현을 필요로 한다면:

```
🔄 이 ADR을 구현하기 위한 태스크를 생성하시겠습니까?

제안하는 태스크:
1. [구현 태스크 1]
2. [구현 태스크 2]
3. [테스트 태스크]
4. [문서 업데이트 태스크]

/aiwf:aiwf_create_general_task 또는 /aiwf:aiwf_add_sprint_task로 생성 가능합니다.
```

---

## 8. 상태 동기화 및 다음 단계

### 8.1 워크플로우 상태 동기화
- `aiwf state update` 명령어로 워크플로우 상태 동기화
- 새로 생성된 ADR 문서의 우선순위 계산
- 관련 태스크 및 마일스톤 업데이트

### 8.2 완료 메시지

```
✅ ADR 생성 완료!

📄 생성된 문서:
- ADR[###]: [제목]
- 위치: .aiwf/05_ARCHITECTURAL_DECISIONS/ADR_[###]_[제목].md
- 상태: [status]

📊 영향 분석:
- 긍정적 영향: [개수]개
- 부정적 영향: [개수]개
- 고려된 대안: [개수]개

🔄 워크플로우 상태 동기화 완료!

다음 단계:
- ADR 검토 및 팀 승인: 팀 회의에서 논의
- 상태 업데이트: status를 'accepted'로 변경
- 구현 태스크 생성: /aiwf:aiwf_create_general_task
- 관련 문서 업데이트: ARCHITECTURE.md 반영

💡 팁:
- ADR은 살아있는 문서입니다. 구현 중 변경사항이 있으면 업데이트하세요.
- 결정이 변경되면 새로운 ADR을 작성하고 이전 ADR을 'superseded'로 표시하세요.
```

---

## 9. ADR 관리 모범 사례

### 9.1 작성 가이드
- **간결하게**: 핵심만 명확하게
- **객관적으로**: 감정이 아닌 사실에 기반
- **시기적절하게**: 결정 직후 작성
- **팀과 함께**: 주요 이해관계자 리뷰

### 9.2 유지보수
- 정기적 검토 (분기별)
- 상태 업데이트
- 관련 문서와 동기화

### 9.3 버전 관리
- Git으로 모든 변경 추적
- 중요한 수정은 새 ADR로 분리

---

## 사용 예시

### 예시 1: API Gateway 패턴 도입

```bash
/aiwf:aiwf_create_adr API Gateway Pattern 도입
```

**대화 흐름:**
```
AI: API Gateway 패턴을 도입하게 된 배경이 무엇인가요?
User: 마이크로서비스 간 통신이 복잡해져서 중앙 집중식 진입점이 필요합니다.

AI: 어떤 API Gateway 솔루션을 선택하셨나요?
User: AWS API Gateway를 사용하기로 했습니다.

AI: 다른 고려한 대안이 있나요?
User: Kong과 Nginx도 고려했습니다.

[... ADR 생성 ...]
```

### 예시 2: 대화형 모드

```bash
/aiwf:aiwf_create_adr
```

**대화 흐름:**
```
AI: 어떤 아키텍처 결정사항을 문서화하시겠습니까?
User: GraphQL로 마이그레이션

AI: 현재 REST API를 GraphQL로 전환하는 것이군요.
   이 결정을 하게 된 주요 이유는 무엇인가요?
User: 클라이언트에서 필요한 데이터만 요청할 수 있게 하고,
      여러 엔드포인트 호출을 줄이고 싶습니다.

[... 대화 계속 ...]
```

---

## 참고 사항

### ADR 템플릿 위치
- `.aiwf/99_TEMPLATES/adr_template.md`

### 관련 명령어
- `/aiwf:aiwf_discuss_review` - ADR 리뷰 논의
- `/aiwf:aiwf_create_general_task` - ADR 구현 태스크 생성
- `/aiwf:aiwf_initialize` - AIWF 프레임워크 초기화

### 추가 리소스
- [Architecture Decision Records](https://adr.github.io/)
- [ADR 작성 가이드](https://github.com/joelparkerhenderson/architecture-decision-record)

---

## 에러 처리

### 일반적인 문제

**문제 1**: `.aiwf/05_ARCHITECTURAL_DECISIONS/` 디렉토리가 없음
- **해결**: 자동으로 디렉토리 생성

**문제 2**: ADR 번호 중복
- **해결**: 기존 ADR 스캔하여 다음 번호 자동 계산

**문제 3**: 필수 정보 누락
- **해결**: 대화형으로 추가 질문

**문제 4**: 프로젝트가 AIWF로 초기화되지 않음
- **해결**: `/aiwf:aiwf_initialize` 실행 안내

---

## 결론

이 워크플로우를 통해:
- ✅ 체계적인 아키텍처 결정 문서화
- ✅ 팀 간 의사소통 개선
- ✅ 기술 부채 예방
- ✅ 향후 결정의 컨텍스트 제공

ADR은 프로젝트의 아키텍처 진화를 추적하는 강력한 도구입니다.
