# Context 압축 - 토큰 절약 실행

토큰 사용량을 줄이기 위해 프로젝트 컨텍스트를 압축합니다. 3단계 압축 모드와 실시간 토큰 모니터링을 제공합니다.

**중요사항:**
- 기본 모드는 'balanced'로 30-50% 토큰 절약을 목표로 합니다
- 압축 전후 토큰 사용량과 절약률을 실시간으로 표시합니다
- 중요한 정보는 모든 모드에서 보존됩니다

## 사용법

```
/project:aiwf:compress_context [mode] [target]
```

### 파라미터

- `mode` (선택적): 압축 모드
  - `aggressive`: 50-70% 토큰 절약 (critical/high 정보만 유지)
  - `balanced`: 30-50% 토큰 절약 (기본값, medium 이상 정보 유지)
  - `minimal`: 10-30% 토큰 절약 (모든 정보 유지, 포맷팅만 최적화)

- `target` (선택적): 압축 대상
  - 파일 경로: 특정 파일 압축
  - 디렉토리 경로: 디렉토리 내 모든 마크다운 파일 압축
  - 생략 시: 현재 프로젝트의 주요 문서 압축

## 압축 전략

### Aggressive 모드 (50-70% 압축)
- Critical/High 중요도 섹션만 유지
- 코드 예제 대폭 축소
- 중복 정보 완전 제거
- Output Log, 히스토리 등 제거

### Balanced 모드 (30-50% 압축)
- Critical/High/Medium 중요도 섹션 유지
- 코드 예제 선택적 유지
- 중복 정보 부분 제거
- 오래된 로그만 제거

### Minimal 모드 (10-30% 압축)
- 모든 중요도 유지
- 공백 및 형식 정리
- 명백한 중복만 제거
- 안전한 압축

## 실행 단계

1. **압축 대상 파악**
   - 대상 파일/디렉토리 확인
   - 원본 토큰 수 계산

2. **압축 모드 적용**
   - 선택된 모드에 따라 압축 전략 실행
   - 중요도 기반 섹션 필터링
   - 압축 알고리즘 적용

3. **압축 결과 검증**
   - 압축 후 토큰 수 계산
   - 절약률 및 품질 점수 표시
   - Critical 정보 보존 검증

4. **압축 파일 생성**
   - 압축된 컨텐츠를 새 파일로 저장
   - 원본 파일은 보존
   - 압축 메타데이터 기록

## 출력 형식

```
🗜️ Context 압축 시작
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
압축 모드: balanced
대상: /workspace/project/.aiwf/

📊 압축 전 통계:
- 총 파일 수: 15
- 원본 토큰: 45,320
- 원본 크기: 125.4 KB

⚙️ 압축 진행 중...
✓ PROJECT_MANIFEST.md (5,320 → 2,890 토큰, -45.6%)
✓ ARCHITECTURE.md (8,210 → 4,105 토큰, -50.0%)
✓ M02_milestone_meta.md (3,450 → 2,070 토큰, -40.0%)
... [추가 파일들]

📊 압축 후 통계:
- 압축된 토큰: 27,192
- 절약된 토큰: 18,128
- 토큰 절약률: 40.0%
- 압축 시간: 2.3초
- 품질 점수: 92/100

✅ 압축 완료!
압축된 파일 위치: /workspace/project/.aiwf_compressed/
```

## 품질 보증

- **Critical 정보 보존**: 목표, 요구사항, 승인 기준은 항상 유지
- **구조 보존**: 문서의 논리적 구조와 계층 유지
- **가독성 유지**: 압축 후에도 읽기 쉬운 형태 유지
- **복원 가능**: 압축 메타데이터로 필요시 복원 지원

## 권장 사용 시나리오

1. **대규모 프로젝트 리뷰 시**: aggressive 모드로 핵심만 빠르게 파악
2. **일반 개발 작업**: balanced 모드로 효율적인 컨텍스트 관리
3. **디버깅/상세 분석**: minimal 모드로 모든 정보 유지하며 최적화

## 주의사항

- 압축된 파일은 별도 디렉토리에 저장되며 원본은 보존됩니다
- 압축 시 일부 형식이나 세부 정보가 손실될 수 있습니다
- Critical로 표시된 정보는 모든 모드에서 보존됩니다